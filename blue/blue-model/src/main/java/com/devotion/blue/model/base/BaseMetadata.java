package com.devotion.blue.model.base;

import java.math.BigInteger;

import com.devotion.blue.message.MessageKit;
import com.devotion.blue.model.Metadata;
import com.devotion.blue.model.core.JModel;
import com.devotion.blue.model.query.MetaDataQuery;
import com.jfinal.plugin.activerecord.IBean;
import com.jfinal.plugin.ehcache.CacheKit;
import com.jfinal.plugin.ehcache.IDataLoader;

/**
 * Auto generated by JPress, do not modify this file.
 */
@SuppressWarnings("serial")
public abstract class BaseMetadata<M extends BaseMetadata<M>> extends JModel<M> implements IBean {

    public static final String CACHE_NAME = "metadata";
    public static final String METADATA_TYPE = "metadata";

    public static final String ACTION_ADD = "metadata:add";
    public static final String ACTION_DELETE = "metadata:delete";
    public static final String ACTION_UPDATE = "metadata:update";

    public void removeCache(Object key) {
        if (key == null) return;
        CacheKit.remove(CACHE_NAME, key);
    }

    public void putCache(Object key, Object value) {
        CacheKit.put(CACHE_NAME, key, value);
    }

    public M getCache(Object key) {
        return CacheKit.get(CACHE_NAME, key);
    }

    public M getCache(Object key, IDataLoader dataloader) {
        return CacheKit.get(CACHE_NAME, key, dataloader);
    }

    public Metadata createMetadata() {
        return createMetadata(null, null);
    }

    public Metadata createMetadata(String key, String value) {
        Metadata md = new Metadata();
        md.setObjectId(getId());
        md.setObjectType(METADATA_TYPE);
        md.setMetaKey(key);
        md.setMetaValue(value);
        return md;
    }

    public boolean saveOrUpdateMetadta(String key, String value) {
        Metadata metadata = MetaDataQuery.me().findByTypeAndIdAndKey(METADATA_TYPE, getId(), key);
        if (metadata == null) {
            metadata = createMetadata(key, value);
            return metadata.save();
        }
        metadata.setMetaValue(value);
        return metadata.update();
    }

    public String metadata(String key) {
        Metadata m = MetaDataQuery.me().findByTypeAndIdAndKey(METADATA_TYPE, getId(), key);
        if (m != null) {
            return m.getMetaValue();
        }
        return null;
    }

    @Override
    public boolean equals(Object o) {
        if (o == null) {
            return false;
        }
        if (!(o instanceof BaseMetadata<?>)) {
            return false;
        }

        BaseMetadata<?> m = (BaseMetadata<?>) o;
        if (m.getId() == null) {
            return false;
        }

        return m.getId().compareTo(this.getId()) == 0;
    }

    @Override
    public boolean save() {
        boolean saved = super.save();
        if (saved) {
            MessageKit.sendMessage(ACTION_ADD, this);
        }
        return saved;
    }

    @Override
    public boolean delete() {
        boolean deleted = super.delete();
        if (deleted) {
            MessageKit.sendMessage(ACTION_DELETE, this);
        }
        return deleted;
    }

    @Override
    public boolean deleteById(Object idValue) {
        boolean deleted = super.deleteById(idValue);
        if (deleted) {
            MessageKit.sendMessage(ACTION_DELETE, this);
        }
        return deleted;
    }

    @Override
    public boolean update() {
        boolean update = super.update();
        if (update) {
            MessageKit.sendMessage(ACTION_UPDATE, this);
        }
        return update;
    }

    public void setId(java.math.BigInteger id) {
        set("id", id);
    }

    public java.math.BigInteger getId() {
        Object id = get("id");
        if (id == null)
            return null;

        return id instanceof BigInteger ? (BigInteger) id : new BigInteger(id.toString());
    }

    public void setMetaKey(java.lang.String metaKey) {
        set("meta_key", metaKey);
    }

    public java.lang.String getMetaKey() {
        return get("meta_key");
    }

    public void setMetaValue(java.lang.String metaValue) {
        set("meta_value", metaValue);
    }

    public java.lang.String getMetaValue() {
        return get("meta_value");
    }

    public void setObjectType(java.lang.String objectType) {
        set("object_type", objectType);
    }

    public java.lang.String getObjectType() {
        return get("object_type");
    }

    public void setObjectId(java.math.BigInteger objectId) {
        set("object_id", objectId);
    }

    public java.math.BigInteger getObjectId() {
        return get("object_id");
    }

}
